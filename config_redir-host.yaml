# ==========================================================
# é”šç‚¹ä¸ç­–ç•¥æ¨¡æ¿
# ==========================================================
pr: &pr {type: select, proxies: [èŠ‚ç‚¹é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶ä»–, DIRECT]}
url-test: &url-test {type: url-test, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, exclude-filter: "LAN"}
fallback: &fallback {type: fallback, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, exclude-filter: "LAN"}
load-balance: &load-balance {type: load-balance, url: https://www.gstatic.com/generate_204, interval: 300, include-all-providers: true, strategy: sticky-sessions, exclude-filter: "LAN"}
p: &p {type: http, interval: 86400, health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}}

# ==========================================================
# åŸºç¡€é…ç½®
# ==========================================================
mixed-port: 7890
ipv6: false
log-level: info
allow-lan: true
unified-delay: true
tcp-concurrent: true
external-controller: 0.0.0.0:9090
secret: ""
keep-alive-idle: 600
keep-alive-interval: 60

# ==========================================================
# Geoæ•°æ®è®¾ç½®
# ==========================================================
geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
global-ua: clash.meta
geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"

profile:
  store-selected: true
  store-fake-ip: false

# ==========================================================
# å—…æ¢å™¨ - å½»åº•å…³é—­ (è§£å†³ CF è§„åˆ™æŠ¢å åŸŸååˆ†æµçš„é—®é¢˜)
# ==========================================================
sniffer:
  enable: false

# ==========================================================
# TUN æ¨¡å¼ä¸ DNS (çº¯æ­£ redir-host)
# ==========================================================
tun:
  enable: true
  stack: system
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

dns:
  enable: true
  cache-algorithm: arc
  ipv6: false
  listen: 0.0.0.0:1053
  enhanced-mode: redir-host
  respect-rules: true
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  direct-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  proxy-server-nameserver:
    - system
    - 223.5.5.5
  nameserver-policy:
    "+.lan": 127.0.0.1#lo
    "+.arpa": 127.0.0.1#lo
    "+.local": 127.0.0.1#lo
    "+.ts.net": 127.0.0.1#tailscale0
    "rule-set:ecs-no-cn":
      - '223.5.5.5#ecs=61.221.31.1/24&ecs-override=true'

ntp:
  enable: true
  write-to-system: true

# ==========================================================
# ä»£ç†ä¸è®¢é˜…
# ==========================================================
proxies:
  - {name: LAN, type: direct, udp: true, interface-name: br-lan}

proxy-providers:
  Sub-Store:
    <<: *p
    url: "è®¢é˜…åœ°å€"

# ==========================================================
# ç­–ç•¥ç»„
# ==========================================================
proxy-groups:
  - {name: èŠ‚ç‚¹é€‰æ‹©, icon: https://ruleset.ihtw.moe/resources/icon/sub(1).png, type: select, proxies: [è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶ä»–, DIRECT]}
  - {name: è‡ªåŠ¨é€‰æ‹©, icon: https://ruleset.ihtw.moe/resources/icon/lightning(2).png, <<: *fallback}
  - {name: Tracker, icon: https://ruleset.ihtw.moe/resources/icon/direct.png, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½]}
  - {name: CloudFlare, icon: https://raw.ihtw.moe/raw.githubusercontent.com/Vbaethon/HOMOMIX/refs/heads/main/Icon/Color/CloudFlare.png, <<: *pr}
  - {name: Emby, icon: https://ruleset.ihtw.moe/resources/icon/emby.png, <<: *pr}
  - {name: Apple, icon: https://ruleset.ihtw.moe/resources/icon/apple.png, type: select, proxies: [ç¾å›½, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, DIRECT]}
  - {name: Github, icon: https://ruleset.ihtw.moe/resources/icon/github.png, <<: *pr}
  - {name: Telegram, icon: https://ruleset.ihtw.moe/resources/icon/telegram(blue1).png, <<: *pr}
  - {name: Google, icon: https://ruleset.ihtw.moe/resources/icon/google(1).png, <<: *pr}
  - {name: YouTube, icon: https://ruleset.ihtw.moe/resources/icon/youtube.png, <<: *pr}
  - {name: TikTok, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/04ProxySoft/tiktok.png, <<: *pr}
  - {name: Netflix, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/04ProxySoft/netflix(red).png, <<: *pr}
  - {name: Disney, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/04ProxySoft/disney(black).png, <<: *pr}
  - {name: TMDB, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/03CNSoft/TMDB.png, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½]}
  - {name: Porns, icon: https://ruleset.ihtw.moe/resources/icon/yuyanyun.png, <<: *pr}
  - {name: Crypto, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/04ProxySoft/Bitcoin.png, <<: *pr}
  - {name: Bilibili, icon: https://ruleset.ihtw.moe/resources/icon/bilibili(1).png, type: select, proxies: [DIRECT, é¦™æ¸¯, å°æ¹¾]}
  - {name: Microsoft, icon: https://ruleset.ihtw.moe/resources/icon/microsoft.png, <<: *pr}
  - {name: AI, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/04ProxySoft/chatGPT-green.png, <<: *pr}
  - {name: Steam, icon: https://raw.ihtw.moe/raw.githubusercontent.com/lige47/QuanX-icon-rule/refs/heads/main/icon/03CNSoft/steam.png, <<: *pr}
  - {name: ADBlock, icon: https://ruleset.ihtw.moe/resources/icon/ad(6).png, type: select, proxies: [REJECT, DIRECT]}
  - {name: MATCH, icon: https://ruleset.ihtw.moe/resources/icon/shutiao.png, <<: *pr}

  # åœ°åŒºåˆ†ç»„
  - {name: é¦™æ¸¯, <<: *url-test, filter: "ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong", icon: https://ruleset.ihtw.moe/resources/icon/Hongkong(2).png}
  - {name: ç¾å›½, <<: *url-test, filter: "ğŸ‡ºğŸ‡¸|ç¾å›½|US|United States", icon: https://ruleset.ihtw.moe/resources/icon/US(1).png}
  - {name: æ–°åŠ å¡, <<: *url-test, filter: "ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|ç‹®|SG|Singapore", icon: https://ruleset.ihtw.moe/resources/icon/singapore(2).png}
  - {name: æ—¥æœ¬, <<: *url-test, filter: "ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|ä¸œäº¬|JP|Japan", icon: https://ruleset.ihtw.moe/resources/icon/Japan(1).png}
  - {name: å°æ¹¾, <<: *url-test, filter: "ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Tai|Taiwan", icon: https://ruleset.ihtw.moe/resources/icon/taiwan.png}
  - {name: ä½å€ç‡, icon: https://ruleset.ihtw.moe/resources/icon/duck(1).png, <<: *fallback, filter: "(?i)(0\\.\\d+)"}
  - {name: å…¶ä»–, icon: https://ruleset.ihtw.moe/resources/icon/XXAI.png, type: select, include-all-providers: true, exclude-filter: "HK|US|SG|JP|TW|LAN"}

# ==========================================================
# åˆ†æµè§„åˆ™ (ä¼˜å…ˆçº§ä¼˜åŒ–ç‰ˆ)
# ==========================================================
rules:
  - DST-PORT,6881-6999,ADBlock # FUCK WPS
  - DST-PORT,8096-8097,Emby
  - DST-PORT,3478/19302,DIRECT
  - GEOIP,lan,LAN,no-resolve
  
  # è‡ªå®šä¹‰ä¸å¹¿å‘Šå±è”½
  - RULE-SET,custom_direct,DIRECT
  - RULE-SET,direct_site,DIRECT
  - RULE-SET,direct_other,DIRECT
  - RULE-SET,tracker_ip,Tracker
  - RULE-SET,tracker_site,Tracker
  - RULE-SET,custom_proxy,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,custom_proxy1,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,custom_reject,ADBlock
  - RULE-SET,ADs_merged,ADBlock
  - RULE-SET,httpdns,ADBlock
  
  # æ ¸å¿ƒæœåŠ¡ (æ”¾åœ¨ CF ä¹‹å‰ï¼Œé˜²æ­¢è¢« CF æ•è·)
  - RULE-SET,ai,AI
  - RULE-SET,crypto,Crypto
  - RULE-SET,youtube,YouTube
  - RULE-SET,tiktok,TikTok
  - RULE-SET,netflix_ip,Netflix
  - RULE-SET,netflix_site,Netflix
  - RULE-SET,disney,Disney
  - RULE-SET,google_site,Google
  - RULE-SET,google_ip,Google
  - RULE-SET,tg_site,Telegram
  - RULE-SET,tg_ip,Telegram
  - RULE-SET,github,Github
  
  # ç‰¹å®šåº”ç”¨ä¸åœ°åŒº
  - RULE-SET,apple-cn,DIRECT
  - RULE-SET,apple_proxy,Apple
  - RULE-SET,biliintl,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,bilibili,Bilibili
  - RULE-SET,bahamut,å°æ¹¾
  - RULE-SET,steamcn,DIRECT
  - RULE-SET,steam,Steam
  - RULE-SET,tmdb,TMDB
  - RULE-SET,emby,Emby
  - RULE-SET,dmm_ip,æ—¥æœ¬
  - RULE-SET,dmm_site,æ—¥æœ¬
  - RULE-SET,win-update,DIRECT
  - RULE-SET,category-cngames,DIRECT
  - RULE-SET,category-porn,Porns
  - RULE-SET,microsoft,Microsoft

  # å…œåº•ä¸æ³›åŒ¹é… (æŠŠå®¹æ˜“è¯¯ä¼¤çš„ CF æ”¾åœ¨ GFW ä¹‹å)
  - RULE-SET,gfwlist,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,proxygfwlist_site,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,proxygfwlist_ip,èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cloudflare,CloudFlare 
  
  # å›½å†…ç›´è¿
  - RULE-SET,cn_site,DIRECT
  - RULE-SET,chinadomains,DIRECT
  - RULE-SET,cn_ip,DIRECT
  - MATCH,MATCH

# ==========================================================
# è§„åˆ™é›†æä¾›è€…
# ==========================================================
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}
  domaintxt: &domaintxt {type: http, interval: 86400, behavior: domain, format: text}
  classical: &classical {type: http, interval: 86400, behavior: classical, format: yaml}
  classicaltxt: &classicaltxt {type: http, interval: 86400, behavior: classical, format: text}
  mrs: &mrs {type: http, interval: 86400, behavior: domain, format: mrs}
  mrsip: &mrsip {type: http, interval: 86400, behavior: ipcidr, format: mrs}

rule-providers:
  custom_direct:
    <<: *domain
    url: "https://git.ihtw.moe/JohnsonRan/CRules/raw/master/rules/custom.yaml"
  custom_proxy:
    <<: *domain
    url: "https://git.ihtw.moe/JohnsonRan/CRules/raw/master/rules/customProxy.yaml"
  custom_reject:
    <<: *domaintxt
    url: "https://git.ihtw.moe/JohnsonRan/CRules/raw/master/rules/reject.txt"
  cloudflare:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/clash/refs/heads/main/Cloudflare.list"
  emby:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/clash/refs/heads/main/Emby.list"
  custom_proxy1:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/clash/refs/heads/main/Custom_Proxys.list"
  ai:
    <<: *mrs
    url: "https://ruleset.ihtw.moe/resources/rules/ai.mrs"
  ADs_merged:
    <<: *mrs
    url: "https://ruleset.ihtw.moe/resources/rules/ADs_merged.mrs"
  biliintl:
    <<: *mrs
    url: "https://ruleset.ihtw.moe/resources/rules/biliintl.mrs"
  tracker_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/PrivateTracker_ipcidr.mrs"
  tracker_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/PrivateTracker_domain.mrs"
  tmdb:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/clash/refs/heads/main/guaxiao.list"
  youtube:
    <<: *mrs
    url: "https://ruleset.ihtw.moe/resources/rules/youtube.mrs"
  tiktok:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/TikTok_domain.mrs"
  netflix_ip:
    <<: *mrsip
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geoip/netflix.mrs"
  netflix_site:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/netflix.mrs"
  disney:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/Disney_domain.mrs"
  google_site:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/google.mrs"
  google_ip:
    <<: *mrsip
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geoip/google.mrs"
  category-porn:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/category-porn.mrs"
  dmm_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/DMM_ipcidr.mrs"
  dmm_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/DMM_domain.mrs"
  crypto:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/main/latest/Crypto_domain.mrs"
  category-cngames:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/category-games@cn.mrs"
  bilibili:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/bilibili.mrs"
  tg_ip:
    <<: *mrsip
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geoip/telegram.mrs"
  tg_site:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/telegram.mrs"
  github:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/github.mrs"
  microsoft:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/microsoft.mrs"
  win-update:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/win-update.mrs"
  bahamut:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/bahamut.mrs"
  cn_site:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/cn.mrs"
  chinadomains:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/github.com/Repcz/Tool/raw/X/mihomo/Rules/ChinaDomain.list" 
  cn_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/github.com/ForestL18/rules-dat/raw/mihomo/asn/combined/China-ASN-combined.mrs"
  httpdns:
    <<: *mrs 
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/category-httpdns-cn.mrs"
  apple-cn: 
    <<: *mrs 
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/apple-cn.mrs"
  apple_proxy:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/github.com/Repcz/Tool/raw/X/mihomo/Rules/AppleProxy.list"
  speedtest:
    <<: *domaintxt
    url: "https://ruleset.skk.moe/Clash/domainset/speedtest.txt"
  gfwlist:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/gfw.mrs"
  steamcn:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/steam@cn.mrs"
  steam:
    <<: *mrs
    url: "https://git.ihtw.moe/JohnsonRan/meta-rules-dat/raw/meta/geo/geosite/steam.mrs"
  no-fakeip:
    <<: *domaintxt
    url: "https://git.ihtw.moe/JohnsonRan/CRules/raw/master/rules/no-fakeip.txt"
  ecs-no-cn:
    <<: *domaintxt
    url: "https://git.ihtw.moe/JohnsonRan/CRules/raw/master/rules/ecs-no-cn.txt"
  direct_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/refs/heads/main/latest/Direct_domain.mrs"
  direct_other:
    <<: *classicaltxt
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/refs/heads/main/latest/Direct_other.txt"
  proxygfwlist_site:
    <<: *mrs
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/refs/heads/main/versioned_rules/2026-02-01-0/rules/ProxyGFWlist_domain.mrs"
  proxygfwlist_ip:
    <<: *mrsip
    url: "https://raw.ihtw.moe/raw.githubusercontent.com/iovejieba/mihomo-mrs/refs/heads/main/versioned_rules/2026-02-01-0/rules/ProxyGFWlist_ipcidr.mrs"
